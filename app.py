import streamlit as st
import feedparser
import urllib.parse
from datetime import datetime

# 1. ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(page_title="æ­´å²ã®ã‚¿ã‚¤ãƒ ãƒã‚·ãƒ³ãƒ»ãƒ‹ãƒ¥ãƒ¼ã‚¹", layout="wide")

# 2. ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®è¨­å®š
st.sidebar.title("ğŸ® æ“ä½œãƒ‘ãƒãƒ«")
search_query = st.sidebar.text_input("ğŸ” ãƒ‹ãƒ¥ãƒ¼ã‚¹æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰", value="äººå·¥çŸ¥èƒ½")
past_years_back = st.sidebar.slider("â³ å·¦å´ã®å¹´ã‚’ä½•å¹´å‰ã«ã—ã¾ã™ã‹ï¼Ÿ", 1, 100, 61)

current_year = datetime.now().year
target_past_year = current_year - past_years_back
target_future_cycle = target_past_year + 60
prediction_year = target_future_cycle + 1

# 3. æ­´å²ãƒ‡ãƒ¼ã‚¿è¾æ›¸ï¼ˆã“ã“ã«äº‹å®Ÿã‚’è©°ã‚è¾¼ã¿ã¾ã™ï¼‰
history_db = {
    1964: "**æ±äº¬ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯é–‹å‚¬ãƒ»æ±æµ·é“æ–°å¹¹ç·šé–‹æ¥­**\næ—¥æœ¬ã®ã‚¤ãƒ³ãƒ•ãƒ©ãŒåŠ‡çš„ã«é€²åŒ–ã—ã€ä¸–ç•Œã«å¾©èˆˆã‚’ç¤ºã—ãŸè±¡å¾´çš„ãªå¹´ã§ã™ã€‚",
    1965: "**åˆã®å•†æ¥­é€šä¿¡è¡›æ˜Ÿãƒ»æ—¥éŸ“åŸºæœ¬æ¡ç´„**\nã€Œé€šä¿¡é©å‘½ã€ã¨ã€Œå¤–äº¤ã®ç¯€ç›®ã€ãŒé‡ãªã‚Šã€ç¾åœ¨ã®å›½éš›ç¤¾ä¼šã®åŸºç¤ãŒã§ãã¾ã—ãŸã€‚",
    1969: "**ã‚¢ãƒãƒ­11å·ãŒæœˆé¢ç€é™¸æˆåŠŸ**\näººé¡ã®æ´»å‹•ç¯„å›²ãŒå®‡å®™ã¸ã¨åºƒãŒã£ãŸã€ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã®æ¥µè‡´ã¨ã„ãˆã‚‹å¹´ã§ã™ã€‚",
    1985: "**ã¤ãã°ä¸‡åšãƒ»ãƒ—ãƒ©ã‚¶åˆæ„**\nãƒã‚¤ãƒ†ã‚¯æŠ€è¡“ã¸ã®æœŸå¾…ã¨ã€æ—¥æœ¬çµŒæ¸ˆã®å¤§ããªè»¢æ›ç‚¹ãŒè¨ªã‚ŒãŸå¹´ã§ã™ã€‚",
    1991: "**ãƒãƒ–ãƒ«å´©å£Šãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã®ä¸€èˆ¬é–‹æ”¾**\nä¸€ã¤ã®æ™‚ä»£ãŒçµ‚ã‚ã‚Šã€ãƒ‡ã‚¸ã‚¿ãƒ«ã¨ã„ã†æ–°ã—ã„æ³¢ãŒæŠ¼ã—å¯„ã›ãŸåˆ†å²ç‚¹ã§ã™ã€‚",
    1995: "**Windows 95ç™ºå£²ãƒ»é˜ªç¥æ·¡è·¯å¤§éœ‡ç½**\nITé©å‘½ã®å¹•é–‹ã‘ã¨ã€ç¤¾ä¼šã®ã‚ã‚Šæ–¹ã‚’å•ã„ç›´ã™å¤§ããªå‡ºæ¥äº‹ãŒé‡ãªã‚Šã¾ã—ãŸã€‚",
    2024: "**æ–°ç´™å¹£ç™ºè¡Œãƒ»ç”ŸæˆAIã®çˆ†ç™ºçš„æ™®åŠ**\nçµŒæ¸ˆã®è±¡å¾´ãŒå¤‰ã‚ã‚‹ã¨åŒæ™‚ã«ã€çŸ¥èƒ½ã®å®šç¾©ãŒæ›¸ãæ›ã‚ã‚Šå§‹ã‚ãŸå¹´ã§ã™ã€‚",
    2025: "**å¤§é˜ªãƒ»é–¢è¥¿ä¸‡åšãƒ»AGIï¼ˆæ±ç”¨äººå·¥çŸ¥èƒ½ï¼‰ã®é€²å±•**\nå‘½ã‚’è¼ã‹ã›ã‚‹æœªæ¥ç¤¾ä¼šã®ãƒ‡ã‚¶ã‚¤ãƒ³ã¨ã€AIã¨ã®å…±ç”ŸãŒæœ¬æ ¼åŒ–ã—ãŸå¹´ã§ã™ã€‚"
}

# 4. ãƒ¡ã‚¤ãƒ³ç”»é¢
st.title(f"ğŸ•°ï¸ æ­´å²ã®è¼ªå»»ï¼š{target_past_year}å¹´ â†” {target_future_cycle}å¹´")

# --- ã‚»ã‚¯ã‚·ãƒ§ãƒ³1: æ­´å²ã®ãƒªã‚¹ãƒˆ ---
st.header(f"ğŸ”„ ç¹°ã‚Šè¿”ã™æ­´å²ã®ã‚µã‚¤ã‚¯ãƒ«")
col1, col2 = st.columns(2)

def get_history_fact(year):
    # è¾æ›¸ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°ãã‚Œã‚’è¿”ã—ã€ãªã‘ã‚Œã°æ±ç”¨ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œã‚‹
    if year in history_db:
        return history_db[year]
    else:
        # ãƒ‡ãƒ¼ã‚¿ãŒãªã„å¹´ã®ãŸã‚ã®æ±ç”¨ãƒ­ã‚¸ãƒƒã‚¯
        if year < 1945: return f"**æ¿€å‹•ã®æ™‚ä»£ï¼ˆ{year}å¹´ï¼‰**\nä¸–ç•ŒãŒå†ç·¨ã•ã‚Œã€æ¬¡ä¸–ä»£ã®æŠ€è¡“ï¼ˆç„¡ç·šã‚„èˆªç©ºãªã©ï¼‰ã®ç¨®ãŒè’”ã‹ã‚ŒãŸé ƒã§ã™ã€‚"
        if year < 2000: return f"**æˆé•·ã¨é©æ–°ã®æ™‚ä»£ï¼ˆ{year}å¹´ï¼‰**\nã‚¢ãƒŠãƒ­ã‚°ã‹ã‚‰ãƒ‡ã‚¸ã‚¿ãƒ«ã¸ã€ä¾¡å€¤è¦³ãŒå¤§ããã‚·ãƒ•ãƒˆã—å§‹ã‚ãŸé‡è¦ãªæ™‚æœŸã§ã™ã€‚"
        return f"**ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ»ã‚°ãƒ­ãƒ¼ãƒãƒ«æ™‚ä»£ï¼ˆ{year}å¹´ï¼‰**\nãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ä¸–ç•ŒãŒä¸€ä½“åŒ–ã—ã€åŠ é€Ÿåº¦çš„ã«å¤‰åŒ–ãŒé€²ã‚“ã§ã„ã‚‹æ™‚ä»£ã§ã™ã€‚"

with col1:
    st.subheader(f"ğŸ—“ï¸ {target_past_year}å¹´")
    st.info(get_history_fact(target_past_year))

with col2:
    st.subheader(f"ğŸ—“ï¸ {target_future_cycle}å¹´")
    # å³å´ãŒæœªæ¥(2026å¹´ä»¥é™)ã®å ´åˆã¯ã€Œæœªæ¥äºˆæ¸¬ã€çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã™ã‚‹
    if target_future_cycle >= current_year:
        st.success(f"**æœªæ¥ã¸ã®åˆ°é”ï¼ˆ{target_future_cycle}å¹´ï¼‰**\nå·¦å´ã®{target_past_year}å¹´ã‹ã‚‰60å¹´ã€‚æ­´å²ã®èºæ—‹ãŒä¸€å‘¨ã—ã€ã‹ã¤ã¦ã®èª²é¡ŒãŒæ–°ã—ã„å½¢ã§è§£æ±ºã•ã‚Œã‚‹å¹´ã§ã™ã€‚")
    else:
        st.success(get_history_fact(target_future_cycle))

# --- ã‚»ã‚¯ã‚·ãƒ§ãƒ³2: æœªæ¥äºˆæƒ³ ---
st.header(f"ğŸ”® {prediction_year}å¹´ æœªæ¥äºˆæƒ³")
st.warning(f"**ã€{prediction_year}å¹´ã®å±•æœ›ã€‘**\n{target_future_cycle}å¹´ã®å‡ºæ¥äº‹ã‚’çµŒã¦ã€ç¤¾ä¼šã¯æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸ã€‚éå»ã®ã‚µã‚¤ã‚¯ãƒ«ã‹ã‚‰è¦‹ã‚‹ã¨ã€ã“ã®å¹´ã¯ã€Œæ–°ã—ã„å¸¸è­˜ã€ãŒå®šç€ã—ã€äººã€…ã®ç”Ÿæ´»æ§˜å¼ãŒå®Œå…¨ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨ãªã‚Šã¾ã™ã€‚")

# --- ã‚»ã‚¯ã‚·ãƒ§ãƒ³3: æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ ---
st.header(f"ğŸ“° æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹: {search_query}")
encoded = urllib.parse.quote(search_query)
feed = feedparser.parse(f"https://news.google.com/rss/search?q={encoded}&hl=ja&gl=JP&ceid=JP:ja")

for entry in feed.entries[:6]:
    st.markdown(f'''
        <div style="background:#f0f2f6; padding:15px; border-radius:10px; border-left:5px solid #ff4b4b; margin-bottom:10px;">
            <strong style="color:#333;">{entry.title}</strong>
        </div>
    ''', unsafe_allow_html=True)
    st.link_button("è¨˜äº‹ã‚’èª­ã‚€", entry.link)
